<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SelfQuest V300 Fixed</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<link rel="stylesheet" href="css/style105.css?v=3.1"> <link rel="manifest" href="./manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
</head>
<body>
<div id="app-frame">
    <div id="hud">
        <div class="hud-left">
            <div class="avatar" id="hud-avatar"></div>
            <div class="hud-info">
                <div class="name">Commander</div>
                <div class="lv-exp-row">
                    <div class="lv-txt">Lv.<span id="ui-lv">1</span></div>
                    <div class="exp-bar-bg"><div class="exp-bar-fill" id="ui-exp-bar"></div><span class="exp-text" id="ui-exp-text">0/100</span></div>
                </div>
            </div>
        </div>
        <div class="hud-right">
            <div class="res-row">
                <div class="coin-pill blue">ğŸ’ <span id="ui-gem">0</span></div> 
                <div class="coin-pill purple">ğŸ’  <span id="ui-p-gem">0</span></div> 
            </div>
            <div class="res-row" style="justify-content: flex-end;">
                <div class="coin-pill gold">ğŸ’° <span id="ui-gold">0</span></div>
                <button class="menu-btn" onclick="act.openModal('settings')">â‰¡</button>
            </div>
        </div>
    </div>

    <div id="stats-overlay">
        <div class="stats-head"><h2>å±¬æ€§</h2><button class="btn-close" onclick="act.closeStats()">âœ•</button></div>
        <div class="stats-body">
            <div class="chart-box"><canvas id="radar"></canvas></div>
            <div class="tabs">
                <button class="tab active" onclick="act.switchTab('attr')" id="tb-attr">èƒ½åŠ›</button>
                <button class="tab" onclick="act.switchTab('cal')" id="tb-cal">ç‹€æ…‹</button>
            </div>
            <div id="sec-attr" class="stat-sec active">
                <div id="attr-list"></div>
                <div class="row" style="margin-top:10px; justify-content: flex-end;">
                    <button class="btn-xs" onclick="act.addNewSkill()">+ æ–°å¢æŠ€èƒ½</button>
                </div>
                <div id="skill-list" style="margin-top:10px"></div>
            </div>
            <div id="sec-cal" class="stat-sec">
                <div class="cal-card cal-show"><div>ä»Šæ—¥ç†±é‡</div><div class="cal-value"><span id="ui-cal-val">0</span> / <span id="ui-cal-max">2000</span></div></div>
                <div id="cal-logs" class="cal-show" style="margin-top:10px;font-size:0.9rem;color:#888;"></div>
                <div class="cal-hide-hint" style="text-align:center;color:#666;margin-top:20px;display:none">(å¡è·¯é‡Œæ¨¡å¼å·²é—œé–‰)</div>
            </div>
        </div>
    </div>

    <div id="content-area">
        <div class="quick-icons" id="main-icons">
            <button class="icon-btn" id="btn-q-task" onclick="act.openModal('quick')">ğŸ“</button>
            <button class="icon-btn" id="btn-q-bag" onclick="act.openModal('bag')">ğŸ’</button>
            <button class="icon-btn" id="btn-q-avatar" onclick="act.navigate('avatar')">ğŸ‘—</button>
            <button class="icon-btn" id="btn-q-qa" onclick="act.showQA()">â“</button>
        </div>

        <div id="page-task" class="page">
            <div class="task-header">
                <div class="header-tabs">
                    <div class="h-tab active" id="tab-task" onclick="act.switchTaskTab('task')">ä»»å‹™</div>
                    <div class="h-tab" id="tab-ach" onclick="act.switchTaskTab('ach')">æˆå°±</div>
                </div>
                <div class="task-header-row" id="task-ctrl-row">
                    <div class="cat-scroll-wrapper"><div class="cat-scroll-container" id="task-cats-row"></div></div>
                    <button class="btn-icon-sm" onclick="act.navToHistory()">ğŸ“œ</button>
                </div>
            </div>
            <div id="task-list"></div>
        </div>

        <div id="page-history" class="page history-theme">
            <div class="page-header"><h2 class="page-title" style="color:#b0a48f;">æ­·å²ç´€éŒ„</h2><button class="btn-bg" style="padding:5px 15px;" onclick="act.navigate('task')">â†© è¿”å›</button></div>
            <div id="history-list"></div>
        </div>

        <div id="page-main" class="page active">
            <div class="main-scene">
                <div class="char-stage" id="lobby-stage">
                    <div class="char-container" onclick="act.openStats()"><div class="char-placeholder">ğŸ¦¸</div><div class="click-hint">é»æ“ŠæŸ¥çœ‹å±¬æ€§</div></div>
                </div>
                <button class="btn-story" id="btn-story-mode" onclick="act.enterStoryMode()">ğŸŒ€ åŠ‡æƒ…æ¨¡å¼</button>
            </div>
        </div>

        <div id="page-shop" class="page">
            <h2 class="page-title" style="color:gold">å•†åº—</h2>
            <div class="npc-box"><div class="npc-face"></div><div class="npc-text" id="shop-npc-text">æ­¡è¿å…‰è‡¨...</div></div>
            <div class="shop-top-row">
                <div class="cat-scroll-wrapper"><div class="cat-scroll-container" id="shop-tabs"></div></div>
                <button class="btn-xs" style="flex-shrink:0; height:38px;" onclick="act.openUpload()">+ ä¸Šæ¶å•†å“</button>
            </div>
            <div class="shop-container-box"><div class="shop-grid" id="shop-list"></div></div>
        </div>
    </div>

    <div id="navbar">
        <button class="nav-item" onclick="act.navigate('task')" id="nav-task">ğŸ“‹ ä»»å‹™</button>
        <button class="nav-item active" onclick="act.navigate('main')" id="nav-main">ğŸ  å¤§å»³</button>
        <button class="nav-item" onclick="act.navigate('shop')" id="nav-shop">ğŸ›’ å•†åº—</button>
    </div>

    <div id="page-story">
        <button class="btn-back-tr" onclick="act.navigate('main')">â†© é›¢é–‹</button>
        <div class="skip-btn" id="story-skip" onclick="act.storySkip()">SKIP â–¶</div>
        <div class="story-stage">
            <div class="story-bg-img"></div>
            <div class="dialogue-box"><div id="story-text">...</div></div>
            <div class="char-left story-emoji" id="story-player-char">ğŸ¦¸</div>
            <div class="char-right story-emoji" id="story-npc-char">ğŸ§™â€â™‚ï¸</div>
        </div>
        <div class="story-ctrl"><button class="btn-explore" id="btn-explore" onclick="act.exploreStory()">ç¹¼çºŒæ¢éšª</button></div>
    </div>

    <div id="page-avatar">
        <button class="btn-back-tr" onclick="act.navigate('main')">â†© è¿”å›</button>
        <div class="avatar-top-stage"><div class="char-placeholder" id="avatar-preview-char">ğŸ¦¸</div></div>
        <div class="avatar-bottom-panel">
            <div class="avatar-tabs" id="wardrobe-tabs">
                <button class="av-tab active" onclick="act.switchWardrobeTab('hair')">é«®å‹</button>
                <button class="av-tab" onclick="act.switchWardrobeTab('top')">ä¸Šè¡£</button>
                <button class="av-tab" onclick="act.switchWardrobeTab('bottom')">ä¸‹è£</button>
                <button class="av-tab" onclick="act.switchWardrobeTab('acc')">é…é£¾</button>
            </div>
            <div class="avatar-scroll-area" id="wardrobe-list"></div>
        </div>
    </div>

    <button class="fab" id="global-fab" onclick="act.handleFab()">+</button>

    <div id="m-create" class="mask">
    <div class="modal">
        <div class="m-head">
            ä»»å‹™è¨­å®š <button class="btn-close" onclick="act.closeModal('create')">âœ•</button>
        </div>
        <div class="m-body">
            <div class="row row-center mb-0">
                <input id="nt-title" class="inp flex-1 mb-0" placeholder="ä»»å‹™æ¨™é¡Œ (ä¾‹å¦‚: è·‘ 3km)">
                <div id="btn-pin-toggle" class="pin-btn" onclick="this.classList.toggle('active'); document.getElementById('nt-pinned').checked = this.classList.contains('active');">ğŸ“Œ</div>
                <input type="checkbox" id="nt-pinned" style="display:none">
            </div>
            
            <textarea id="nt-desc" class="inp inp-area mt-sm" placeholder="å‚™è¨»æˆ–ç´°ç¯€..."></textarea>
            
            <label class="lbl">é›£åº¦èˆ‡å›é¥‹</label>
            <div class="row">
                <select id="nt-difficulty" class="inp flex-1" style="font-weight:bold; color:#d84315;">
                    <option value="S">ğŸŸ¢ ç°¡å–® (Relax)</option>
                    <option value="M" selected>ğŸ”µ ä¸­ç­‰ (Normal)</option>
                    <option value="L">ğŸŸ  å›°é›£ (Hard)</option>
                    <option value="XL">ğŸ”´ å²è©© (Epic)</option>
                </select>
                <select id="nt-tag-select" class="inp flex-1">
                    <option value="">(ç„¡æŠ€èƒ½ç¶å®š)</option>
                    <option value="é‹å‹•">é‹å‹• (é«”èƒ½)</option>
                    <option value="é–±è®€">é–±è®€ (æ™ºæ…§)</option>
                    <option value="å®¶äº‹">å®¶äº‹ (éˆå·§)</option>
                    <option value="ä¿é¤Š">ä¿é¤Š (é­…åŠ›)</option>
                    <option value="æ—©èµ·">æ—©èµ· (æ¯…åŠ›)</option>
                    <option value="å†¥æƒ³">å†¥æƒ³ (å¹¸é‹)</option>
                </select>
            </div>
            
            <div class="row row-center">
                <label class="lbl flex-1">é¡¯ç¤ºåˆ†é¡:</label>
                <select id="nt-cat-select" class="inp flex-2">
                    <option value="æ¯æ—¥">æ¯æ—¥ç¿’æ…£</option>
                    <option value="é›œäº‹" selected>å¾…è¾¦é›œäº‹</option>
                    <option value="é¡˜æœ›">é¡˜æœ›æ¸…å–®</option>
                    <option value="å·¥ä½œ">å°ˆæ¡ˆå·¥ä½œ</option>
                </select>
            </div>

            <div class="row row-center" style="justify-content:space-between; margin-top:10px; border-top:1px solid #ccc; padding-top:10px;">
                <label class="lbl" style="margin:0">å­ä»»å‹™ / æ­¥é©Ÿ</label>
                <button class="btn-xs" onclick="act.addSubtask()">+ æ–°å¢æ­¥é©Ÿ</button>
            </div>
            <div id="nt-subs" class="mt-md"></div>
            
            <label class="lbl" style="margin-top:15px;">é€²éšè¨­å®š</label>
            <div class="row">
                <input type="datetime-local" id="nt-deadline" class="inp flex-1">
                <select id="nt-type" class="inp flex-1" onchange="document.getElementById('nt-target').style.display = this.value==='count'?'block':'none'">
                    <option value="normal">ä¸€èˆ¬ä»»å‹™</option>
                    <option value="count">è¨ˆæ¬¡ä»»å‹™</option>
                </select>
                <input id="nt-target" type="tel" class="inp flex-1" style="display:none;" placeholder="æ¬¡æ•¸">
            </div>
        </div>
        <div class="m-foot">
            <button class="btn-ok" style="flex:2;" onclick="act.submitTask()">å»ºç«‹ä»»å‹™</button>
        </div>
    </div>
</div>

<script src="js/data105.js"></script>
<script src="js/view105.js"></script>
<script src="js/core105.js"></script>
<script src="js/modules/stats105.js"></script>
<script src="js/modules/task105.js"></script>
<script src="js/modules/ach105.js"></script>
<script src="js/modules/shop105.js"></script>
<script src="js/modules/story105.js"></script> 
<script src="js/modules/avatar105.js"></script> 
<script src="js/main105.js?v=10.1"></script> <script>
// å¼·åˆ¶ä¿®å¾©ï¼šç•¶åˆ‡æ›æ¨¡å¼æ™‚ï¼Œè‡ªå‹•æ›´æ–° body çš„ class
(function() {
    const originalChangeMode = window.act.changeMode;
    window.act.changeMode = function(mode) {
        if (originalChangeMode) originalChangeMode(mode);
        document.body.classList.remove('mode-adventurer', 'mode-harem', 'mode-basic');
        document.body.classList.add('mode-' + mode);
        console.log("ä»‹é¢é¢¨æ ¼å·²åˆ‡æ›ç‚º:", mode);
    };
    const savedMode = localStorage.getItem('selfquest_mode') || 'adventurer';
    const selectEl = document.getElementById('set-mode');
    if(selectEl) document.body.classList.add('mode-' + selectEl.value);
})();
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(function(registrations) {
      for(let registration of registrations) registration.unregister();
    });
}
</script>

</body>
</html>